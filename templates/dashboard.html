{% extends "base.html" %}

{% block title %}Dashboard - AI Churn Predictor{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-tachometer-alt"></i> Single Customer Prediction</h1>
    <p>Enter customer details to predict churn probability</p>
</div>

<div class="section">
    <div style="max-width: 800px; margin: 0 auto;">
        <div class="card">
            <form id="predictionForm">
                <h3 style="margin-bottom: 1.5rem; color: #00d4ff;">
                    <i class="fas fa-user"></i> Customer Demographics
                </h3>
                
                <div class="grid-3">
                    <div class="form-group">
                        <label class="form-label">Gender</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="gender" value="Male" checked> Male
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="gender" value="Female"> Female
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Senior Citizen</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="senior" value="1"> Yes
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="senior" value="0" checked> No
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Partner</label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="partner" value="Yes"> Yes
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="partner" value="No" checked> No
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Dependents</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="dependents" value="Yes"> Yes
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="dependents" value="No" checked> No
                        </label>
                    </div>
                </div>
                
                <h3 style="margin: 2rem 0 1.5rem; color: #00d4ff;">
                    <i class="fas fa-file-invoice-dollar"></i> Account Information
                </h3>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Tenure (months)</label>
                        <input type="number" name="tenure" class="form-control" min="0" max="100" value="12" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Contract Type</label>
                        <select name="contract" class="form-control" required>
                            <option value="Month-to-month">Month-to-month</option>
                            <option value="One year">One year</option>
                            <option value="Two year">Two year</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Payment Method</label>
                        <select name="payment" class="form-control" required>
                            <option value="Electronic check">Electronic check</option>
                            <option value="Mailed check">Mailed check</option>
                            <option value="Bank transfer (automatic)">Bank transfer (automatic)</option>
                            <option value="Credit card (automatic)">Credit card (automatic)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Internet Service</label>
                        <select name="internet" class="form-control" required>
                            <option value="Fiber optic">Fiber optic</option>
                            <option value="DSL">DSL</option>
                            <option value="No">No internet service</option>
                        </select>
                    </div>
                </div>
                
                <div class="grid-2">
                    <div class="form-group">
                        <label class="form-label">Monthly Charges ($)</label>
                        <input type="number" name="monthly" class="form-control" step="0.01" value="70.00" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Total Charges ($)</label>
                        <input type="number" name="total" class="form-control" step="0.01" value="840.00" required>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem; padding: 1rem;">
                    <i class="fas fa-magic"></i> Predict Churn
                </button>
            </form>
        </div>
        
        <div id="resultCard" style="display: none; margin-top: 2rem;">
            <div class="card" style="border: 2px solid #00d4ff;">
                <h3 style="margin-bottom: 1.5rem; color: #00d4ff;">
                    <i class="fas fa-chart-line"></i> Prediction Result
                </h3>
                
                <div style="text-align: center; padding: 2rem;">
                    <div style="font-size: 3rem; margin-bottom: 1rem;" id="resultIcon"></div>
                    <div style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem; color: #ffffff;" id="resultStatus"></div>
                    <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem;" id="resultProb"></div>
                    <div style="color: #8899aa;">Churn Probability</div>
                    
                    <div style="margin-top: 1.5rem; padding: 1rem; background: rgba(0,212,255,0.05); border-radius: 10px;" id="resultBadge"></div>
                </div>
                
                <div id="recommendations" style="padding: 1.5rem; background: #1b263b; border-radius: 10px; margin-top: 1rem;"></div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('predictionForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(e.target);
    const data = {
        Gender: formData.get('gender'),
        SeniorCitizen: parseInt(formData.get('senior')),
        Partner: formData.get('partner'),
        Dependents: formData.get('dependents'),
        tenure: parseInt(formData.get('tenure')),
        Contract: formData.get('contract'),
        PaymentMethod: formData.get('payment'),
        MonthlyCharges: parseFloat(formData.get('monthly')),
        TotalCharges: parseFloat(formData.get('total')),
        InternetService: formData.get('internet')
    };
    
    try {
        const res = await fetch('/predict', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        });
        
        const result = await res.json();
        
        const resultCard = document.getElementById('resultCard');
        const icon = document.getElementById('resultIcon');
        const status = document.getElementById('resultStatus');
        const prob = document.getElementById('resultProb');
        const badge = document.getElementById('resultBadge');
        const recs = document.getElementById('recommendations');
        
        const probability = Math.round(result.probability * 100);
        
        if (result.risk_level === 'High') {
            icon.innerHTML = '<i class="fas fa-exclamation-triangle" style="color: #ff5252;"></i>';
            status.textContent = 'WILL CHURN';
            status.style.color = '#ff5252';
            prob.textContent = probability + '%';
            prob.style.color = '#ff5252';
            badge.innerHTML = '<span class="badge badge-high">HIGH RISK</span>';
            recs.innerHTML = '<h4 style="color: #ff5252; margin-bottom: 1rem;"><i class="fas fa-lightbulb"></i> Recommendations</h4><ul style="color: #c0cde0; line-height: 1.8;"><li>Contact customer immediately</li><li>Offer retention incentives or discounts</li><li>Review contract options and upgrade paths</li><li>Assign dedicated account manager</li></ul>';
        } else if (result.risk_level === 'Medium') {
            icon.innerHTML = '<i class="fas fa-exclamation-circle" style="color: #ffab40;"></i>';
            status.textContent = 'MAY CHURN';
            status.style.color = '#ffab40';
            prob.textContent = probability + '%';
            prob.style.color = '#ffab40';
            badge.innerHTML = '<span class="badge badge-medium">MEDIUM RISK</span>';
            recs.innerHTML = '<h4 style="color: #ffab40; margin-bottom: 1rem;"><i class="fas fa-lightbulb"></i> Recommendations</h4><ul style="color: #c0cde0; line-height: 1.8;"><li>Monitor customer engagement closely</li><li>Send personalized offers</li><li>Improve service quality</li><li>Request feedback survey</li></ul>';
        } else {
            icon.innerHTML = '<i class="fas fa-check-circle" style="color: #69f0ae;"></i>';
            status.textContent = 'WILL STAY';
            status.style.color = '#69f0ae';
            prob.textContent = probability + '%';
            prob.style.color = '#69f0ae';
            badge.innerHTML = '<span class="badge badge-low">LOW RISK</span>';
            recs.innerHTML = '<h4 style="color: #69f0ae; margin-bottom: 1rem;"><i class="fas fa-lightbulb"></i> Recommendations</h4><ul style="color: #c0cde0; line-height: 1.8;"><li>Maintain current service quality</li><li>Offer loyalty rewards</li><li>Cross-sell premium features</li><li>Request referrals</li></ul>';
        }
        
        resultCard.style.display = 'block';
        resultCard.scrollIntoView({ behavior: 'smooth' });
        
    } catch (error) {
        alert('Error making prediction: ' + error.message);
    }
});
</script>
{% endblock %}
